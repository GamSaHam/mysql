
MySQL 5.6 버전까지는 InnoDB 스토리지 더티 페이지 플러시 기능이 그다지 부드럽게 처리되지 않았다. 예를 들어, 급작스럽게
디스크 기록이 폭증해서 MySQL 서버의 사용자 쿼리 처리 성능에 영향을 받는 경우가 많았다.
5.7버전과 8.0 버전으로 업그레이드 되면서 대부분의 서비스에서는 더티 페이지를 디스크에 동기화 하는 부분에서
예전과 같은 디스크 쓰기 폭증 현상은 발생하지 않았다. 여기서 InnoDB 스토리지 엔진의 더티 페이지의 디스크 쓰기 동기화
와 관련된 시스템 설정을 살펴보겠지만 특별히 서비스를 운영할 때 성능 문제가 발생하지 않는 상태라면 굳이 이 시스템 변수들을
아 조정할 필요는 없다.

InnoDB 스토리지 엔진은 버퍼 풀에서 아직 디스크로 기록되지 않은 더티 페이지들을 성능상의 악영향 없이 디스크 동기화하기
위해 다음과 같이 2개의 플러시 기능을 백그라운드로 실행한다.

- 플러시 리스트(Flush_list) 플러시
- LRU 리스트(LRU_list) 플러시

4.2.7.4.1 플러시 리스트 플러시

InnoDB 버퍼 풀은 클린 페이지뿐만 아니라 사용자의 DML(INSERT, UPDATE, DELETE)에 의해 변경된 더티 페이지도 함께 가지고 있다.
InnoDB 스토리지 엔진에서는 innodb_max_dirty_pages_pct_lwm 이라는 시스템 설정 변수를 이용해 일정 수준 이상의 더티 
페이지가 발생하면 조금씩 더티 페이지를 디스크로 기록하게 하고있다.

시스템 기본값은 10% 수준인데 만약 더티 페이지의 비율이 얼마 되지 않은 상태에서 디스크 쓰기가 많이 발생하고 
더티 페이지의 비율이 너무 낮은 상태로 계속 머물러 있다면 innodb_max_dirty_pages_lwm 시스템 변수를 조금 더 높은 값으로
조정하는 것도  디스크 쓰기 횟수를 줄이는 효과를 얻을 수 있다.

innodb_io_capacity와 innodb_io_capcity_max 시스템 변수는 각 데이터베이스 서버에서 어느 정도의 디스크 읽고 쓰기가 가능
한지를 설정하는 값이다. innodb_io_capacity는 일반적인 상황에서 디스크가 적절히 처리할 수 있는 수준의 값을 설정하며,
innodb_io_capacity_max 시스템 변수는 디스크가 최대의 성능을 발휘할 때 어느 정도의 디스크 읽고 쓰기가 가능한지를 설정
한다.

innodb_io_capocity와 innodb_io_capacity_max 시스템 변수에 1000을 설정한다고 해서 초당 1000번의 디스크 쓰기를 보장하는
것은 아니다. Innodb 스토리지 엔진은 내부적인 최적화 알고리즘을 가지고 있어서 설정된 값들을 기준으로 적당히 계산된
횟수 만큼 더티 페이지 쓰기를 하기 때문이다. 그래서 innodb_io_capacity와 innodb_io_capacity_max 시스템 변수를 설정하고
어느 정도 디스크 쓰기를 하는지 관찬하면서 분석하고 패턴을 익히는 것이 중요하다.

어댑티브 플러시 기능이 활성화되면 InnoDB 스토리지 엔진은 단순히 버퍼 풀의 디티 페이지가 생성되는지를 분석하는 것인데,
이는 결국 리두 로그가 어느 정도 속도로 증가하는지를 분석하는 것과 같다. innodb_adaptive_flushing_lwm 시스템 변수의
기본값은 10%인데, 이는 전체 리두 로그 공간에서 활성 리두 로그의 공간이 10% 미만이면 어댑티브 플러시가 작동하지 않다가
10% 넘으면 그때 부터 어댑티브 플러시 알고리즘이 작동 한다.

마지막으로 innodb_flush_neighbors 시스템 변수는 더티 페이지를 디스크에 기록할 때 디스크에서 근접한 페이지 중에서
더티 페이지가 있다면 InnoDB 스토리지 엔진이 함께 묶어서 디스크로 기록하게 해주는 기능을 활성화 할지 결정한다.

예전에 많이 사용하던 하드디스크(HDD)의 경우 디스크 읽고 쓰기를 줄이기 위해 많은 노력을 기울였는데, 이웃 페이지들의
동시 쓰기(innodb_flush_neighbors)는 그러한 노력의 결과라고 볼 수 있다. 데이터 저장을 하드디스크로 하고 있다면
innodb_flush_neighbors 시스템 변수를 1또는 2로 설정해서 활성화하는 것이 좋다. 하지만 요즘 솔리드 스테이드 드라이브
(SSD)를 사용하기 때문에 기본값인 비활성 모드로 유지하는 것이 좋다.


















































